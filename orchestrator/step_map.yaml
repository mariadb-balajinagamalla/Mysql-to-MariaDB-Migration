# Map orchestrator phases to your existing shell scripts.
# Each step is:
#   id: stable id (used in state.json)
#   name: human readable
#   script: relative path from repo root
#   args: optional list of args

modes:
  one_step:
    - one_step_prepare
    - precheck_only
    - one_step
    - validate

  two_step:
    - two_step_prepare
    - precheck_only
    - two_step_schema
    - two_step_data
    - two_step_finalize
    - validate

  binlog:
    - binlog_prepare
    - precheck_only
    - binlog_seed
    - binlog_replication
    - binlog_verify

phases:
  precheck_only:
    - id: precheck
      name: Precheck source variables and blockers
      script: scripts/00_precheck.sh
      args: []
  validate:
    - id: validate
      name: Validate after upgrade
      script: scripts/07_validate.sh
      args: []

  one_step_prepare:
    - id: preflight_one_step
      name: Preflight checks (one_step)
      script: scripts/00_preflight_one_step.sh
      args: []

    - id: create_migration_user
      name: Create migration user on source and target
      script: scripts/09_create_migration_user.sh
      args: []

  two_step_prepare:
    - id: preflight_two_step
      name: Preflight checks (two_step)
      script: scripts/00_preflight_two_step.sh
      args: []

  binlog_prepare:
    - id: preflight_binlog
      name: Preflight checks (binlog)
      script: scripts/00_preflight_binlog.sh
      args: []

  one_step:
    - id: one_step_dump_restore
      name: One-step dump/restore (mariadb-dump | mariadb)
      script: scripts/10_one_step_migration.sh
      args: []

  two_step_schema:
    - id: two_step_schema_only
      name: Export schema only (no data)
      script: scripts/11_two_step_schema.sh
      args: []

  two_step_data:
    - id: two_step_parallel_data
      name: Parallel data transfer with SQLines Data
      script: scripts/12_two_step_sqldata.sh
      args: []

  two_step_finalize:
    - id: two_step_finalize_objects
      name: Apply constraints/indexes/routines after data load
      script: scripts/13_two_step_finalize.sh
      args: []

  binlog_seed:
    - id: binlog_seed_dump_restore
      name: Seed target with dump/restore snapshot
      script: scripts/14_binlog_seed.sh
      args: []

  binlog_replication:
    - id: binlog_start_replication
      name: Configure and start MariaDB replication from MySQL binlog
      script: scripts/15_binlog_start_replication.sh
      args: []

  binlog_verify:
    - id: binlog_verify_replication
      name: Verify replication status and lag
      script: scripts/16_binlog_verify.sh
      args: []
